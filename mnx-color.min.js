!function(a){"use strict";function e(e){return{restrict:"A",require:"ngModel",link:function(i,j,k,l){function A(){z=i.$watch(k.ngModel,E)}function B(a){var b=this,c=b.offsetParent;q={name:b.getAttribute("name"),width:b.clientWidth-1,height:b.clientHeight-1,top:c.offsetTop+c.clientTop+b.offsetTop+b.clientTop,left:c.offsetLeft+c.clientLeft+b.offsetLeft+b.clientLeft},z(),C(a),e.on("mousemove",C).on("mouseup",function d(){e.off("mousemove",C).off("mouseup",d),A()})}function C(a){var b=Math.min(q.width,Math.max(0,a.pageX-q.left)),c=Math.min(q.height,Math.max(0,a.pageY-q.top));a.stopPropagation(),a.preventDefault(),D(b,c)}function D(a,b){"alpha"===q.name?(o=a/q.width,y.css({left:a+"px"})):("col"===q.name?(n[1]=a/q.width,n[2]=(q.height-b)/q.height,w.css({top:b+"px",left:a+"px"})):"hue"===q.name&&(n[0]=b/q.height,x.css({top:b+"px"}),s.css({"background-color":"rgb("+h([n[0],1,1])+")"})),m=h(n),v.attr("stop-color","rgb("+m+")")),1!==o?l.$setViewValue("rgba("+m+","+Math.round(100*o)/100+")"):l.$setViewValue(["#",("0"+m[0].toString(16)).substr(-2),("0"+m[1].toString(16)).substr(-2),("0"+m[2].toString(16)).substr(-2)].join("")),l.$render()}function E(a,b){if(a!==b){var c=[];if(c=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a))m=[parseInt(c[1]+c[1],16),parseInt(c[2]+c[2],16),parseInt(c[3]+c[3],16)];else if(c=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(a))m=[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16)];else if(c=/^rgba?\((\d+),\s?(\d+),\s?(\d+),?\s?(\d*\.?\d+)?\)$/.exec(a))m=[+c[1],+c[2],+c[3]];else{if(!a||!(c=/^[a-z]{3,}$/i.exec(a)))return;if(t.css({color:c[0]}),c=window.getComputedStyle(t[0]).color.match(/(\d)+/g)||[0,0,0,"0"],c.join()===m.join()+(1!==o?","+o:""))return;c.unshift(0),m=[+c[1],+c[2],+c[3]]}o=+(c[4]||1),F()}}function F(){n=g(m),w.css({top:Math.round(s[0].clientHeight-1-n[2]*(s[0].clientHeight-1))+"px",left:Math.round(n[1]*(s[0].clientWidth-1))+"px"}),x.css({top:Math.round(n[0]*(t[0].clientHeight-1))+"px",left:0}),y.css({top:0,left:Math.round(o*(u[0].clientWidth-1))+"px"}),s.css({"background-color":"rgb("+h([n[0],1,1])+")"}),v.attr("stop-color","rgb("+m+")")}var q,z,m=[0,0,0],n=[0,0,0],o=1,r=a.element('<div class="'+b+'container"></div>'),s=a.element(['<div name="col" class="'+b+'col">',c,f("s",["fff","fff0"]),f("v",["0000","000"],1),"</defs>",d+"s)/>",d+"v)/></svg>","</div>"].join("")),t=a.element(['<div name="hue" class="'+b+'hue">',c,f("h",["f00","ff0","0f0","0ff","00f","f0f","f00"],1),"</defs>",d+"h)/></svg>","</div>"].join("")),u=a.element(['<div name="alpha" class="'+b+'alpha">',c,f("a",["0000","000"]),"</defs>",d+"a)/></svg>","</div>"].join("")),v=u.find("stop"),w=a.element('<div class="'+b+'ccursor"></div>'),x=a.element('<div class="'+b+'hcursor"></div>'),y=a.element('<div class="'+b+'acursor"></div>');r.append(s.append(w)).append(t.append(x)).append(u.append(y)),j.on("focus",function(){r.css({top:j[0].offsetTop+j[0].offsetHeight+"px",left:j[0].offsetLeft+"px"}),j.after(r),s.on("mousedown",B),t.on("mousedown",B),u.on("mousedown",B),F(),A(),j.on("blur",function a(){j.off("blur",a),z(),r.remove()})})}}}function f(a,b,c){for(var d=["<linearGradient id=",a,c?" x2=0 y2=1":"",">"],e=0,f=b.length-1;f>=e;e+=1)d.push("<stop offset=",e/f," stop-color=#",b[e].substr(0,3)," stop-opacity=",b[e][3]||1,"/>");return d.push("</linearGradient>"),d.join("")}function g(a){var b=a[0]/255,c=a[1]/255,d=a[2]/255,e=Math.max(b,c,d),f=Math.min(b,c,d),g=e-f,h=0,i=0;if(e!==f){switch(e){case b:h=(c-d)/g+(d>c?6:0);break;case c:h=(d-b)/g+2;break;case d:h=(b-c)/g+4}h/=6,i=g/e}return[h,i,e]}function h(a){var b=6*a[0],c=a[1],d=a[2],e=Math.floor(b),f=b-e,g=d*(1-c),h=d*(1-c*f),i=d*(1-c*(1-f)),j=e%6,k=[d,h,g,g,i,d][j],l=[i,d,d,h,g,g][j],m=[g,g,i,d,d,h][j];return[Math.round(255*k),Math.round(255*l),Math.round(255*m)]}var b="mnx-color-",c="<svg width=100% height=100% xmlns=http://www.w3.org/2000/svg><defs>",d="<rect width=100% height=100% fill=url(#";e.$inject=["$document"],a.module("mnxColor",[]).directive("mnxColor",e)}(window.angular);
